local use_ticket = 0 
if pc . has_item_from_special_item_group ( GuildDragonLairSetting . Guild . TicketGroup ) then 
say ( locale_quest ( 1835 ) ) 
use_ticket = select ( locale_quest ( 1847 ) , locale_quest ( 1846 ) ) 
end 
say ( locale_quest ( 1769 ) ) 
local lair_name_list = { 
locale_quest ( 1770 ) , 
locale_quest ( 1771 ) , 
locale_quest ( 1772 ) , 
} 
table . insert ( lair_name_list , locale_quest ( 1845 ) ) 
local lair_choice = select_table ( lair_name_list ) 
if lair_choice >= table . getn ( lair_name_list ) then 
return 
end 
local lair_type = math . max ( lair_choice - 1 , 0 ) 
if lair_type == 0 then 
if game . get_event_flag ( "red_guild_dragonlair" ) == 0 then 
say ( locale_quest ( 1778 ) ) 
return 
end 
if use_ticket ~= 1 then 
say ( string . format ( locale_quest ( 1773 ) , GuildDragonLairSetting . Guild . LadderPoint ) ) 
say ( string . format ( locale_quest ( 1774 ) , GuildDragonLairSetting . Guild . LadderPoint / 2 ) ) 
say ( string . format ( locale_quest ( 1775 ) , GuildDragonLairSetting . Guild . LadderPoint / 2 ) ) 
say ( locale_quest ( 1777 ) ) 
if select ( locale_quest ( 1847 ) , locale_quest ( 1846 ) ) == 2 then 
return 
end 
else 
say ( locale_quest ( 1837 ) ) 
say ( locale_quest ( 1838 ) ) 
say ( locale_quest ( 1840 ) ) 
use_ticket = select ( locale_quest ( 1847 ) , locale_quest ( 1846 ) ) 
if use_ticket ~= 1 then 
return 
end 
end 
local channel = guild . get_event_flag ( "dragonlair_channel" ) 
local wait_time = guild . get_event_flag ( "dragonlair_wait_time" ) 
local create_time = guild . get_event_flag ( "create_time" ) 
if channel ~= 0 then 
say ( locale_quest ( 1780 ) ) 
return 
end 
if use_ticket ~= 1 then 
if channel == 0 and get_global_time ( ) - wait_time < GuildDragonLairSetting . Guild . WaitTime then 
say ( locale_quest ( 1783 ) ) 
return 
end 
end 
if get_global_time ( ) - create_time < 86400 then 
say ( locale_quest ( 1843 ) ) 
return 
end 
if guild . level ( pc . get_guild ( ) ) < GuildDragonLairSetting . Guild . GuildLevel then 
say ( locale_quest ( 1782 ) ) 
return 
end 
if guild . get_near_count ( ) < GuildDragonLairSetting . Guild . MinMember and not pc . is_gm ( ) then 
say ( locale_quest ( 13817 ) ) 
return 
end 
if use_ticket ~= 1 then 
if guild . get_ladder_point ( ) < GuildDragonLairSetting . Guild . LadderPoint then 
say ( locale_quest ( 1781 ) ) 
return 
end 
end 
if guild . get_any_war ( ) ~= 0 then 
say ( locale_quest ( 1784 ) ) 
return 
end 
if use_ticket == 1 then 
if not pc . has_item_from_special_item_group ( GuildDragonLairSetting . Guild . TicketGroup ) then 
say ( locale_quest ( 1836 ) ) 
return 
end 
end 
if guild_dragonlair . register_guild ( lair_type , use_ticket ) then 
say ( locale_quest ( 1779 ) ) 
else 
say ( locale_quest ( 1789 ) ) 
end 
elseif lair_type == 1 then 
if game . get_event_flag ( "blue_guild_dragonlair" ) == 0 then 
say ( locale_quest ( 1778 ) ) 
return 
end 
elseif lair_type == 2 then 
if game . get_event_flag ( "green_guild_dragonlair" ) == 0 then 
say ( locale_quest ( 1778 ) ) 
return 
end 
end 
