quest mining begin
	state start begin
		when 20015.chat.locale_quest(1301) begin
			setskin(NOWINDOW)
			npc.open_shop()
		end

		when 20015.take with item.get_vnum() >= 29101 and item.get_vnum() < 29110 and item.get_socket(0) != item.get_value(2) begin
			say_title(locale_quest(6671))
			say(locale_quest(6672))
		end

		when 20015.take with item.get_vnum() >= 29101 and item.get_vnum() < 29110 and item.get_socket(0) == item.get_value(2) begin
			say_title(locale_quest(6671))
			say(string.format(locale_quest(6673), item.get_level()))
			if item.get_value(3) == 100 then
				say_title(locale_quest(6671))
				say(locale_quest(6674))
			else
				say_title(locale_quest(6671))
				say(string.format(locale_quest(6675), (100 - item.get_value(3))))
			end

			local s = select(locale_quest(4473), locale_quest(3418))
			if s == 2 then
				say_title(locale_quest(6671))
				say(locale_quest(6676))
				return
			end

			local f = __refine_pick(item.get_cell())
			if f == 2 then
				say_title(locale_quest(6671))
				say(locale_quest(6677))
			elseif f == 1 then
				say_title(locale_quest(6671))
				say(locale_quest(6678))
			else
				say_title(locale_quest(6671))
				say(locale_quest(6679))
			end
		end
	end
end
